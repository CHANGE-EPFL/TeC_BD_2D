%% BG initial, based on steady state from CHAMAU
dB_flux=zeros(num_cell,55,8);
P=zeros(num_cell,55);
Ptm1=zeros(num_cell,55);
RexmyItm1=zeros(num_cell,3);
RexmyI=zeros(num_cell,3);
PHs=5;
Upl=0.008;
LEAK_NH4=zeros(num_cell,1);
LEAK_NO3=zeros(num_cell,1);
LEAK_P=zeros(num_cell,1);
LEAK_K=zeros(num_cell,1);
LEAK_DOC=zeros(num_cell,1);
LEAK_DON=zeros(num_cell,1);
LEAK_DOP=zeros(num_cell,1);
R_litter=zeros(num_cell,1);
R_microbe=zeros(num_cell,1);
R_litter_sur=zeros(num_cell,1);
R_ew=zeros(num_cell,1);
VOL=zeros(num_cell,1);
N2flx=zeros(num_cell,1);
Min_N=zeros(num_cell,1);
Min_P=zeros(num_cell,1);
R_bacteria=zeros(num_cell,1);
RmycAM=zeros(num_cell,1);
RmycEM=zeros(num_cell,1);
Prod_B=zeros(num_cell,1);
Prod_F=zeros(num_cell,1);
BfixN=zeros(num_cell,1);
LitFirEmi=zeros(num_cell,2);

% Rd_NH4=zeros(num_cell,1);
% Rd_NO3=zeros(num_cell,1);
% Rd_P=zeros(num_cell,1);
% Rd_K=zeros(num_cell,1);
% Rd_DOC=zeros(num_cell,1);
% Rd_DON=zeros(num_cell,1);
% Rd_DOP=zeros(num_cell,1);
NEE=zeros(num_cell,1);

%% initial values for an example
% 
% Nreserve_Ltm1= 7.5*ones(num_cell,cc_max);
% Preserve_Ltm1= 0.55*ones(num_cell,cc_max);
% Kreserve_Ltm1= 2.8*ones(num_cell,cc_max);
% 
% Nreserve_Htm1= 7.5*ones(num_cell,cc_max)*1.5;
% Preserve_Htm1= 0.55*ones(num_cell,cc_max)*1.5;
% Kreserve_Htm1= 2.8*ones(num_cell,cc_max)*1.5;

FNC_Ltm1=1*ones(num_cell,cc_max);

% NupI_Ltm1(:,:,1) = 0.10866;
% NupI_Ltm1(:,:,2) = 0.007844;
% NupI_Ltm1(:,:,3) = 0.041600;
%
% NupI_Htm1(:,:,1) = 0.10866*2; %multiply by 2, is it reasonable?
% NupI_Htm1(:,:,2) = 0.007844*2;
% NupI_Htm1(:,:,3) = 0.041600*2;
%
% RexmyItm1(:,1) = 0.04685;
% RexmyItm1(:,2) = 0.12003;
% %RexmyItm1(:,3) = 0;
% RexmyItm1(:,3) = 0.5;% root exudates to high vegetation, should have a value?
%
% NavlItm1(:,1) = 0.491*2; %*2 FOR more nurtient available for mineral
% NavlItm1(:,2) = 0.0363*2;
% NavlItm1(:,3) = 0.1653*2;
%
%
% for ii=1:num_cell
%     if MASKn(ii)== 1
%     Ptm1(ii,1:55)=1000*[ 0.125058323623613   0.331492841956637   0.055153164737343                   0                   0   0.106545776397086,...
%         0.130152646652338   0.014461405183593   0.679083359004130   0.966530132450958   6.682770254265284   0.008562021215738,...
%         0.006309642813074   0.000068954335702   0.000043373075760   0.000028730973209   0.000072288459601   0.043379971628909,...
%         0.142594653474930   0.051308356465522                   0   0.002269771399924   0.010807463358596                   0,...
%         0.004809032005655   0.946025338170192   0.008369508208843   0.021979657773539   0.002852827441936                   0,...
%         0.000309843383482   0.000031633522226   0.000026495680780   0.000226977139993   0.000780834292220                   0,...
%         0.000346262009287   0.137514873573224   0.002709812306318   0.003570543222058   0.000427924116290                   0,...
%         0.000022069475017   0.150000000000000   0.000834499816223   0.015010533133807   0.000000222487831   0.005435212585202,...
%         0   0.000558301361478   0.020245150099706   0.000040438105769   0.000033986846738   0.004410679675017,...
%         0.503240898696182];
%     end
% end


for ii=1:num_cell

    if MASKn(ii)== 1 && ksv(ii) == 2 && SOIL(ii)==1 %%%%%%%%%%%grass land, bare soil

        % Nreserve_Ltm1(ii)= 9.809190918570746; %
        Nreserve_Ltm1(ii)= 8;
        Preserve_Ltm1(ii)= 0.749197672641707; %
        Kreserve_Ltm1(ii)= 6.816504289346752; %%%% cc_max = 1; so its (ii,1,1:3)
        NupI_Ltm1(ii,1,1:3)= [ 0.0503    0.0039    0.0276];
        RexmyItm1(ii,1:3)= [0.0333    0.1294         0];
        NavlItm1(ii,1:3)=[   0.2239    0.0189    0.6494]*100;

        %%%%
        % Ptm1(ii,:)=      1000*[ 0.060840289486076   0.177127579085009   0.028301484451631                   0                   0   0.099936872834869   0.146005997182125   0.016222888575792,...
        %     0.364617245225235   0.831377301538433   5.621052282522604   0.007268739864131   0.005385048555363   0.000047575338276   0.000029727596085   0.000019823057615,...
        %     0.000049545993475   0.024725695592212   0.081326635592730   0.061119503143927                   0   0.000377822820435   0.004523386426174                   0,...
        %     0.005023505436829   0.728387752181811   0.004755959838946   0.012514264031843   0.003397987349415                   0   0.000060430317324   0.000004962699293,...
        %     0.000018447352413   0.000037782282044   0.000348950279763                   0   0.000378023362294   0.113251373350087   0.001544474333996   0.002033507318988,...
        %     0.000509698102412                   0   0.000001326699123   0.247355754664312   0.000757762119386   0.015001441297566   0.000000161495759   0.004054524519052,...
        %     0   0.001007475596185   0.017809223471772   0.000362929937998   0.000360397870957   0.008803197242721   0.370456823215809];

%%%%%% pools from steady state calibration
   Ptm1(ii,:)=      1000*[0.106635627112170   0.244268223005713   0.039687626472167  -0.000000000002380  -0.000000000002380   0.103839171400867   0.182401989090281   0.020266887676698,...
   0.549095562936157   0.632875286837422   4.783569863876402   0.007091963654922   0.005673570925280   0.000049772156524   0.000030409485426   0.000020738398552,...
   0.000050682475710   0.022808303018513   0.072120348658071   0.025715908984905  -0.000000000160931   0.002553889957860   0.004622618358757  -0.000000000002380,...
   0.005273009679823   0.695121814090115   0.004404426811417   0.011123889718728   0.001427163813794  -0.000000000079178   0.000400122574493   0.000126561103125,...
   0.000050371072739   0.000255388995786   0.000330187025625  -0.000000000002380   0.000376643548559   0.107383630153266   0.001424515192912   0.001807083814957,...
   0.000214074572069  -0.000000000079178   0.000037834349334   0.239571617458830   0.000785576001100   0.015011030366257   0.000000141986993   0.002311309179379,...
  -0.000000000002380   0.000613140660445   0.008928007071115   0.000154380328910   0.000142527052750   0.003205417463343   0.456560712411912];

    elseif MASKn(ii)== 1 && ksv(ii) == 2 && SOIL(ii)>1 %% grass land, other soil
        % Nreserve_Ltm1(ii)= [9.7834];
        Nreserve_Ltm1(ii)= [8];
        Preserve_Ltm1(ii)= [0.7009];
        Kreserve_Ltm1(ii)= [6.9057];
        NupI_Ltm1(ii,1,1:3)= [0.0502    0.0036    0.0280];
        RexmyItm1(ii,1:3)= [0.0328    0.1267         0];
        NavlItm1(ii,1:3)=[   0.2264    0.0157    0.7917]*100;
        %%%%
        %%%
        % Ptm1(ii,:)=      1000*[ 0.061040469510112   0.177825180846111   0.028410145161920  0  0   0.099687105245691   0.144556019771040   0.016061779974560,...
        %     0.468306601611337   1.048160110514703   7.089906590832216   0.009674261960993   0.007177851862616   0.000054140791738   0.000034036887949   0.000022558663224,...
        %     0.000056728146582   0.024507217960006   0.081778080750546   0.059924804435097  0   0.000204795347827   0.004543552008144  0,...
        %     0.005003428664641   0.911795902879157   0.004713759031569   0.012583307560424   0.003331540814399  0   0.000074234375381   0.000006469897249,...
        %     0.000017766203919   0.000020479534783   0.000326362562104  0   0.000357193974124   0.139102748545761   0.001530797159494   0.002044708872659,...
        %     0.000499731122160  0   0.000002701458769   0.248306175749098   0.000476475217123   0.015001280501713   0.000000151345643   0.004143374374550,...
        %     0   0.001023308978617   0.023274369791353   0.000521324062971   0.000518649390691   0.012464353111011   0.419907058092894];

   Ptm1(ii,:)=      1000*[0.106823102148688   0.244677049881598   0.039750774506866  -0.000000000003114  -0.000000000003114   0.102366818348482   0.179808276842480   0.019978697426942,...
   0.675793998022322   0.823075657623936   6.165266549100481   0.009282320475798   0.007425856399461   0.000057979885442   0.000035517077237   0.000024158285601,...
  0.000059195128729   0.023532513328685   0.074801044854348   0.025675994068538  -0.000000000211107   0.002058267743683   0.004632483653335  -0.000000000003114,...
   0.005197981537467   0.864980635519362   0.004543684330832   0.011536224215445   0.001424944702901  -0.000000000103865   0.000403083858444   0.000114536503738,...
   0.000049604940523   0.000205826774369   0.000330891689524  -0.000000000003114   0.000371284395533   0.134816022821772   0.001469712969212   0.001874167449609,...
   0.000213741705435  -0.000000000103865   0.000037932136760   0.240446047061115   0.000787758024666   0.015010752287412   0.000000141184405   0.002316241826668,...
  -0.000000000003114   0.000604416457845   0.010937764553821   0.000154971234815   0.000143100146734   0.003218849180851   0.473989236426357];

    
    elseif MASKn(ii)== 1 && ksv(ii) == 1 && SOIL(ii)==1 %% tree, bare soil
        %%%%%%%%%
        Wm_H=1/(40.1*365);
        B_Htm1(ii,:,6) =1.3041e+04;
        % Nreserve_Htm1(ii)=1.5; %
        Nreserve_Htm1(ii)=1.3; %
        Preserve_Htm1(ii)= 0.2 ; % what does negetive value mean? nutrient limited?
        Kreserve_Htm1(ii)= 3; %
        NupI_Htm1(ii,1,1:3)= [ 0.034414153255046   0.001469235984856   0.014580644647015];
        RexmyItm1(ii,1:3)= [ 0.041836870523162   0.077321268735448                   0];
        NavlItm1(ii,1:3)=[   0.337481298255138   0.011937867446823   1.217724738572000]*100;
        %%%
        % Ptm1(ii,:)=      1000*[   0.064790355397923   0.194874403526666   0.030418694690306   4.038435766491553   1.346145255497211,...
        %     0.075345394133267   0.475172775472137   0.102793680568152   3.395263450274132   0.958884974511784,...
        %     7.324382159919804   0.007175309931415   0.005452285303409   0.000061398316484   0.000041394996416,...
        %     0.000025582631869   0.000068991660693   0.037912401345778   0.144128786183411   0.036298244995140,...
        %     0   0.000418021216861   0.003859856673461   0.018589624956866   0.005118591252812,...
        %     0.827699600058278   0.007299519672708   0.022195341500977   0.002013992444672  0,...
        %     0.000253823940366   0.000017814538937   0.000019296584436   0.000039802121686   0.000130986540260,...
        %     0.001327830354062   0.000230382707934   0.144732791156970   0.002366202198962   0.003607417297474,...
        %     0.000302098866701  0   0.000003666146151   0.150000000000000   0.000156118736272,...
        %     0.015003563873705   0.000000187031069   0.002730974598801   0.009294812478433   0.000921034873940,...
        %     0.010348261363264   0.001189540468174   0.001179351786865   0.020736999516470   0.503250958989077];

   Ptm1(ii,:)=      1000*[0.070469207233160   0.241590145349270   0.038184030575771   4.626665381166957   1.542221793722668   0.081982394562011   0.578840573038662   0.124571102926924,...
   3.444772137583664   0.756901241311638   6.222256370843899   0.007077846389629   0.005662277118340   0.000059377573395   0.000038770425755   0.000024740655581,...
    0.000064617376258   0.033335209829617   0.120386852664910   0.035001822206066  -0.000000000158807   0.002557610368446   0.002474632973086   0.021297348579980,...
   0.004686278355719   0.786469680416346   0.006416110509579   0.018540672980264   0.001942533907476  -0.000000000078133   0.000150813802869   0.000046135873202,...
   0.000043659244915   0.000253761036845   0.000176759498077   0.001521239184282   0.000334734168266   0.150837355295592   0.002080621774322   0.003014318134312,...
   0.000291380086121  -0.000000000078133   0.000012763092104   0.150000000000000   0.000252088988339   0.015006557135279   0.000000162221640   0.001237316486543,...
   0.010648674289985   0.000666653687083   0.006019762278144   0.000066620423483   0.000058508427315   0.001316438479191   0.503363438224095 ];
    
    elseif MASKn(ii)== 1 && ksv(ii) == 1 && SOIL(ii)>1 %% tree, other soil
        Wm_H=1/(40.18*365);
        B_Htm1(ii,1,6) =1.3041e+04;
        % Nreserve_Htm1(ii)=2; %
        Nreserve_Htm1(ii)=0.8; %
        Preserve_Htm1(ii)= 0.2 ; % what does negetive value mean? nutrient limited?
        Kreserve_Htm1(ii)= 3; %
        NupI_Htm1(ii,1,1:3)= [ 0.031551373882952   0.001429727654417   0.014467582169635];
        RexmyItm1(ii,1:3)= [ 0.041218628724301   0.077090351234181                   0];
        NavlItm1(ii,1:3)=[   0.293799367449778   0.011812238766983   0.937525215422740]*100;
        %%%
        %%%
        % Ptm1(ii,:) =      1000*[ 0.064099756488410   0.196860980470666   0.030714617842170   4.092860023445397   1.364286674481844   0.073650570855377   0.467543896711293   0.100704041689946,...
        %     4.138630468000923   1.205837431675581   9.149310669276646   0.009524992379548   0.007208557647254   0.000070043014847   0.000047371068380   0.000029184589520,...
        %     0.000078951780633   0.037627820177351   0.143948079584865   0.036099665376001                   0   0.000341254893473   0.003413223746106   0.018840149314273,...
        %     0.004689028502422   0.993161591510102   0.007243156458125   0.022165754704554   0.002003142123172                   0   0.000216435544841   0.000015032113677,...
        %     0.000017907881266   0.000032125489348   0.000129546603923   0.001345724951019   0.000223113068602   0.178123915360300   0.002348312585067   0.003602842324919,...
        %     0.000300471318476                   0   0.000002934144446   0.150000000000000   0.000157142183961   0.015003362866730   0.000000180166322   0.002704560790632,...
        %     0.009420074657136   0.000898023673638   0.011793108971388   0.000883639745452   0.000873532396535   0.015587864139937   0.503249138080558 ];


   Ptm1(ii,:) =      1000*[0.070638049310945   0.241877048914717   0.038194140806819   4.617510061165288   1.539170020388779   0.080892658122562   0.570952865084861   0.122857181722761,...
   4.105837570171492   0.975066942217302   7.902380038341460   0.009263369559069   0.007410695672805   0.000068747790478   0.000044903404927   0.000028644912699,...
   0.000074839008211   0.033998937026398   0.122864386036961   0.034868909594442  -0.000000000208250   0.002053692842803   0.002484608964743   0.021255205043458,...
   0.004622970610507   0.964216340964813   0.006543782818068   0.018921781084220   0.001935152916088  -0.000000000102459   0.000152094748324   0.000043372949347,...
   0.000043068017905   0.000203369284281   0.000177472068910   0.001518228931680   0.000330212186465   0.185567792362977   0.002122054590403   0.003076306749269,...
   0.000290272937413  -0.000000000102459   0.000012840496012   0.150000000000000   0.000253816449483   0.015006368742872   0.000000160805474   0.001242304482371,...
   0.010627602521729   0.000657589555687   0.007282129304552   0.000066932135393   0.000058828262966   0.001323634760221   0.503362796452666];


    end
end
clear ii Ptm1

load('9y_RF_Ptm1_haf_P22.mat')

Zs = [ 0 10 20 50 100 150 200 300 400 500 600 ]; %%% [ms+1]
dz= diff(Zs); %%%% [mm]  Thickness of the Layers
for ii=1:ms_max
    O_t(:,ii,1)=  reshape(Ofc,m_cell*n_cell,1);
end
V_t(:,:,1)= (O_t(:,:,1) -reshape(Ohy,m_cell*n_cell,1)).*dz;
clear ii
clear Ofc Ohy








