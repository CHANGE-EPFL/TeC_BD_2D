%% BG initial, based on steady state from Harfen
dB_flux=zeros(num_cell,55,8);
P=zeros(num_cell,55);
Ptm1=zeros(num_cell,55);
RexmyItm1=zeros(num_cell,3);
RexmyI=zeros(num_cell,3);
PHs=5;
Upl=0.01;
LEAK_NH4=zeros(num_cell,1);
LEAK_NO3=zeros(num_cell,1);
LEAK_P=zeros(num_cell,1);
LEAK_K=zeros(num_cell,1);
LEAK_DOC=zeros(num_cell,1);
LEAK_DON=zeros(num_cell,1);
LEAK_DOP=zeros(num_cell,1);
R_litter=zeros(num_cell,1);
R_microbe=zeros(num_cell,1);
R_litter_sur=zeros(num_cell,1);
R_ew=zeros(num_cell,1);
VOL=zeros(num_cell,1);
N2flx=zeros(num_cell,1);
Min_N=zeros(num_cell,1);
Min_P=zeros(num_cell,1);
R_bacteria=zeros(num_cell,1);
RmycAM=zeros(num_cell,1);
RmycEM=zeros(num_cell,1);
Prod_B=zeros(num_cell,1);
Prod_F=zeros(num_cell,1);
BfixN=zeros(num_cell,1);
LitFirEmi=zeros(num_cell,2);

% Rd_NH4=zeros(num_cell,1);
% Rd_NO3=zeros(num_cell,1);
% Rd_P=zeros(num_cell,1);
% Rd_K=zeros(num_cell,1);
% Rd_DOC=zeros(num_cell,1);
% Rd_DON=zeros(num_cell,1);
% Rd_DOP=zeros(num_cell,1);
NEE=zeros(num_cell,1);

%% initial values for an example
%
% Nreserve_Ltm1= 7.5*ones(num_cell,cc_max);
% Preserve_Ltm1= 0.55*ones(num_cell,cc_max);
% Kreserve_Ltm1= 2.8*ones(num_cell,cc_max);
%
FNC_Ltm1=1*ones(num_cell,cc_max);

% B_grass=spin_grass(BiogeoPar);
% B_tree=spin_tree(BiogeoPar);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for ii=1:num_cell
    if MASKn(ii)== 1 && ksv(ii) == 2 %%%%%%%%%%%grass land
  %      %%%%%%%%%%%%%%%%%%%%% pools for calibration, m5
  %        Nreserve_Ltm1(ii)= 6.8525; %
  %       Preserve_Ltm1(ii)= 0.05 ; %
  %       Kreserve_Ltm1(ii)= 6.5877 ; %%%% cc_max = 1; so its (ii,1,1:3)
  %       NupI_Ltm1(ii,1,1:3)= [ 0.0552    0.0029    0.0240];
  %       RexmyItm1(ii,1:3)= [ 0.0331    0.0854         0];
  %       NavlItm1(ii,1:3)=[  0.4536    0.0195    0.2420];
  %       %%%%
  %       Ptm1(ii,:)=     1000*[ 0.065318406008465   0.194201307879508   0.030927200143808  0  0   0.108881172661922   0.148450581462703   0.016494509051411,...
  %  0.600461746161387   0.682224616376616   4.880546840471115   0.008841130554164   0.007073383017902   0.000059712933050   0.000035643753825   0.000024880388771,...
  %  0.000059406256375   0.027717126608745   0.083110394666287   0.040014153523532  0   0.002829755555579   0.004664177037950  0,...
  %   0.005197187688083   0.785862528109947   0.005349320739318   0.012814375286630   0.002224850864728  0   0.000249314620018   0.000084078933236,...
  %  0.000015037705586   0.000282975555556   0.000222616868719  -0.000000000000044   0.000280506325425   0.108436725135549   0.001731408450376   0.002081138257535,...
  %  0.000333727629709  0   0.000019184345897   0.234366480022381   0.000315347452460   0.015011238535798   0.000000115261303   0.003142247391340,...
  % 0   0.000714576156751   0.008715668517373   0.000070440628442   0.000066404157578   0.002906088791635   0.491102343222091  ];

        %%%%%%%%% original pools
        Nreserve_Ltm1(ii)= 4.07; %
        Preserve_Ltm1(ii)= 0.05 ; %
        Kreserve_Ltm1(ii)= 5.88 ; %%%% cc_max = 1; so its (ii,1,1:3)
        NupI_Ltm1(ii,1,1:3)= [ 0.050622818855329   0.003112271545765   0.018798279749436];
        RexmyItm1(ii,1:3)= [ 0.034494477728013   0.083401382638014                   0];
        NavlItm1(ii,1:3)=[  0.368914375972645   0.021511814488325   0.163037496597298];
        %%%%

        % Ptm1(ii,:)=B_grass(end,:);
        % Ptm1(ii,:)=     1000*[0.062674875332067   0.191826685910838   0.030551855779452  0  0   0.116444834648398   0.169313987641775   0.018812665293531,...
        %     0.667619939157285   0.879680848021738   6.373419072455444   0.011236289201382   0.008565045151504   0.000057265982294   0.000036132407701   0.000023860825956,...
        %     0.000060220679501   0.026533965810904   0.087025188780213   0.039547623449071  0   0.003426318133265   0.004016908609679  0,...
        %     0.005402528725519   0.818951801359877   0.005117364548026   0.013411430102050   0.002198905330508  0   0.000261494278459   0.000024709192281,...
        %     0.000014159525593   0.000342631813326   0.000230459737314  0   0.000322751053327   0.121481001906996   0.001656932910759   0.002178741523830,...
        %     0.000329835799576  0   0.000014442996380   0.241774716734465   0.000487001952707   0.015007314480066   0.000000119208821   0.002581746861144,...
        %     0   0.000681087743212   0.013767134651951   0.000049301377576   0.000045326002402   0.002761102696826   0.468095839370535];

  %  Ptm1(ii,:)=10000*[0.012887678521659   0.026513768835875   0.004294053140209  -0.000000000000306  -0.000000000000306   0.009849579839365   0.015730209309402   0.001747801034378,...
  %  0.054980795510874   0.065851824049736   0.487701851906640   0.000969636557271   0.000775709245775   0.000005215822167   0.000003352752518   0.000002173259236,...
  %  0.000005587920863   0.001832207452842   0.006412859218477   0.002762981381532  -0.000000000022002   0.000472759786163   0.000645718115902  -0.000000000000306,...
  %  0.000578731901920   0.075821844906487   0.000354670706030   0.000989833449233   0.000153338048960  -0.000000000010825   0.000051872636189   0.000007639517410,...
  %  0.000001884766762   0.000047275978616   0.000046122722564  -0.000000000000306   0.000041337992994   0.010500684763027   0.000114482000145   0.000160719707577,...
  %  0.000023000707344  -0.000000000010825   0.000009998014770   2.225634090052153   0.000206048604771   0.150087460583758   0.000000014290608   0.000322859057951,...
  % -0.000000000000306   0.000067294407200   0.001219372744019   0.000017195888966   0.000015728961617   0.000353867324381   0.049097316650901];
  % 


  %  Ptm1(ii,:)=10000*[0.012887678521659   0.026513768835875   0.004294053140209  -0.000000000000306  -0.000000000000306   0.009849579839365   0.015730209309402   0.001747801034378,...
  %  0.054980747092949   0.065851893223213   0.487702327772202   0.000969636557271   0.000775709245775   0.000005215826732   0.000003352755345   0.000002173261138,...
  %  0.000005587925575   0.001832210660043   0.006412870033077   0.002762981381532  -0.000000000022002   0.000472757790703   0.000645718115902  -0.000000000000306,...
  %   0.000578731901920   0.075820314530414   0.000354616443662   0.000989877483989   0.000153338048960  -0.000000000010825   0.000046401470598   0.000011867526542,...
  %  0.000001884743933   0.000047275779070   0.000046122722564  -0.000000000000306   0.000041337992994   0.010500686803967   0.000114482200304   0.000160719978234,...
  %  0.000023000707344  -0.000000000010825   0.000009999680873   2.225634090052153   0.000206082941260   0.150087462559334   0.000000014290621   0.000322859057951,...
  % -0.000000000000306   0.000067294407200   0.000243874309129   0.000017195888964   0.000015728961616   0.000353867324328   0.049097316650901];


   Ptm1(ii,:)=10000*[0.012887678521659   0.026513768835875   0.004294053140209  -0.000000000000306  -0.000000000000306   0.009849579839365   0.015730209309402   0.001747801034378,...
   0.054980747092949   0.065851893223213   0.487702327772202   0.000969636557271   0.000775709245775   0.000005215826732   0.000003352755345   0.000002173261138,...
   0.000005587925575   0.001832210660043   0.006412870033077   0.002762981381532  -0.000000000022002   0.000472757790703   0.000645718115902  -0.000000000000306,...
   0.000578731901920   0.075820314530414   0.000354616443662   0.000989877483989   0.000153338048960  -0.000000000010825   0.000046401470598   0.000011867526542,...
   0.000001884743933   0.000047275779070   0.000046122722564  -0.000000000000306   0.000041337992994   0.010500686803967   0.000114482200304   0.000160719978234,...
   0.000023000707344  -0.000000000010825   0.000009999680873   2.225634090052153   0.000206082941260   0.150087462559334   0.000000014290621   0.000322859057951,...
  -0.000000000000306   0.000067294407200   0.000609685772822   0.000017195888965   0.000015728961616   0.000353867324348   0.049097316650901];




    elseif MASKn(ii)== 1 && ksv(ii) == 1 %% tree
        %%%%%%%%%
        % Wm_H=7.277273319212755e-05;
        % B_Htm1(ii,:,1:8) =1.0e+04 *[0.033092308952079   0.084705546337639   0.047195657817041   0.001260057362465   0.001137111675597   1.416593548682712   0.001350153649459                   0];
        % Nreserve_Htm1(ii)=2.4807; %
        % Preserve_Htm1(ii)= 0.8 ; % what does negetive value mean? nutrient limited?
        % Kreserve_Htm1(ii)= 3.3; %
        % NupI_Htm1(ii,1,1:3)= [0.031327007996010   0.001120597488657   0.013336716166987];
        % RexmyItm1(ii,1:3)= [  0.043531068921503   0.117123685073707                   0];
        % NavlItm1(ii,1:3)=[   0.151085765467329   0.004213896703253   1.597712750335796];
        %%%
        %      Ptm1(ii,:)=      1000*[0.048419860706317   0.149108932310541   0.024255750831141   2.717674498571964   0.905891499523995   0.054143190353263   0.362588942040311   0.077379086758603,...
        % 3.199372157656633   0.917669281579656   6.728233098707366   0.011284750014664   0.008654899761861   0.000057228869558   0.000037483059897   0.000023845362316,...
        % 0.000062471766494   0.027659009266885   0.097798487091643   0.024456742557860  -0.000000000207362   0.002701711627574   0.002242743869695   0.012509930231527,...
        % 0.003340824382689   0.736055948324597   0.005319784076702   0.015046895105238   0.001359675722144  -0.000000000102503   0.000223892553334   0.000016393720370,...
        % 0.000009240729812   0.000268171162757   0.000075447384437   0.000893566445108   0.000143607541598   0.130356885075799   0.001727149126976   0.002445235721406,...
        %   0.000203951358322  -0.000000000102503   0.000000066515175   0.150000000000000   0.000193308041507   0.015003686918836   0.000000095491569   0.001926499027231,...
        % 0.006254965115764   0.000642833213227   0.009011753257150   0.000268041765956   0.000265850384872   0.004821384870077   0.503245439820917];
        %
        % Ptm1(ii,:)=      1000*[0.059576653790907   0.161682111550778   0.025754645814455   4.579969309944372   1.526656436648242   0.070346464075470   0.481669504185348   0.109352766202642,...
        % 3.886444723455175   0.946350307224011   7.290504706397882   0.009586333889231   0.007131103813949   0.000071964072260   0.000048448348140   0.000029985030108,...
        % 0.000080747246900   0.041546864787289   0.157332514045400   0.056340005369120  0   0.002528882409219   0.003493998297837   0.021082398410856,...
        % 0.005095332519849   0.820001005002232   0.007994280095081   0.024221678836413   0.003132611537460  0   0.000106013728499   0.000008684688264,...
        % 0.000019796718149   0.000250888240922   0.000092163300376   0.001505885600775   0.000186260246066   0.148724201034617   0.002593256653057   0.003936949206685,...
        % 0.000469891730619  0   0.000000064169656   0.150000000000000   0.000161646290387   0.015003023101284   0.000000201401380   0.002477994671774,...
        % 0.010541199205430   0.000934332040300   0.008560366142193   0.001375658818143   0.001374140778021   0.009201340335749   0.503243561054109];
        %
% %%%%%%%%%%%%%%%%%%%%% pools for calibration, m5
%  Wm_H=1/(37.6477*365); % remember to change the parameter file
%         B_Htm1(ii,:,1:8) =1.0e+04 *[0.033092308952079   0.084705546337639   0.047195657817041   0.001260057362465   0.001137111675597   1.416593548682712   0.001350153649459                   0];
%         Nreserve_Htm1(ii)=0.807; %
%         Preserve_Htm1(ii)= 0.1 ; % what does negetive value mean? nutrient limited?
%         Kreserve_Htm1(ii)= 1.8; %
%         NupI_Htm1(ii,1,1:3)= [0.021184670554794   0.001012117280635   0.010709616922136];
%         RexmyItm1(ii,1:3)= [  0.034744102744920   0.056980741788897                   0];
%         NavlItm1(ii,1:3)=[   0.269268325564927   0.013175961694624   0.241702416322464];
% 
%         Ptm1(ii,:)=      1000*[0.053017634434226   0.161469810713924   0.025877650620965   2.880090437516577   0.960030145838884   0.057271813152231   0.331508930506523   0.069970108536226,...
%    3.001816248028783   0.685829984362497   5.396579510088198   0.008804407456725   0.006851890134790   0.000060195304002   0.000038911312186   0.000025081376667,...
%    0.000064852186977   0.029055037127763   0.102686858632381   0.027132794997761  0   0.001051487370399   0.002079393508308   0.013257559156823,...
%    0.002861267534837   0.691921551527952   0.005591379025551   0.015808345095285   0.001508625715766  0   0.000155618212572   0.000040688998390,...
%    0.000008984015632   0.000105148737039   0.000101384157884   0.000946968511202   0.000161127791349   0.128659597240609   0.001814221886941   0.002569428167959,...
%    0.000226293857365  0   0.000006038531573   0.234280849374317   0.000282513533677   0.015011881593380   0.000000098250153   0.001966219201601,...
%    0.006628779578411   0.000581297622190   0.003856014521344   0.000137033353478   0.000134469197611   0.002793451367174   0.491257503745359];

        %%%%%%%%%%%%% new pools (original, after P improvement)
        Wm_H=1/(37.6477*365); % remember to change the parameter file
        B_Htm1(ii,:,1:8) =1.0e+04 *[0.033092308952079   0.084705546337639   0.047195657817041   0.001260057362465   0.001137111675597   1.416593548682712   0.001350153649459                   0];
        Nreserve_Htm1(ii)=1.55; %
        Preserve_Htm1(ii)= 1.0198 ; % what does negetive value mean? nutrient limited?
        Kreserve_Htm1(ii)= 4.55; %
        NupI_Htm1(ii,1,1:3)= [0.0260    0.0035    0.0148];
        RexmyItm1(ii,1:3)= [  0.0529    0.1086         0];
        NavlItm1(ii,1:3)=[   0.1156    1.5238    1.2212];

        % Ptm1(ii,:)=      1000*[ 0.062897052108134   0.168561842208223   0.027315207249964   3.965281355721222   1.321760451907074   0.086216645087922   0.557402107881226   0.121872614757457,...
        %     4.070045517648678   1.134364664195275   8.262377819649442   0.010885765646900   0.008267992889528   0.000071188982649   0.000046245938417   0.000029662076104,...
        %     0.000077076564028   0.042512229965067   0.148084451125088   0.053193814411157  0   0.001312949437231   0.002312664264246   0.018252882431097,...
        %     0.004692391904523   0.890075013401377   0.008177607094636   0.022793580321116   0.002957647253479  0   0.000063391939905   0.000004827770648,...
        %     0.000018714890656   0.002387289112021   0.000385015115986   0.002250766761354   0.000611639420227   0.184993849739304   0.002654446798504   0.003705677067160,...
        %     0.000443647088022  0   0.001572426175887   0.150000000000000   0.041852807257569   0.150059355651857   0.000000244101250   0.002645111404239,...
        %     0.009126441215549   0.001096303167172   0.011871570635662   0.001085569950566   0.001082460650723   0.018801730827738   0.503252761989035];
        % Ptm1(ii,:)=B_tree(end,:);
   % 
   % Ptm1(ii,:)=      10000*[ 0.006411595531858   0.022508020045985   0.003621703706700   0.365160566719313   0.121720188906433   0.006475020014293   0.045736929944541   0.009854702537076,...
   % 0.286857847065575   0.068681170371741   0.558246386702523   0.000944489434415   0.000755591543763   0.000005460478482   0.000003780662374   0.000002275199368,...
   % 0.000006301103957   0.002161301112199   0.008776256026773   0.002797209269757  -0.000000000020971   0.000383126252607   0.000216507442531   0.001680897846804,...
   % 0.000369438278293   0.063716692340366   0.000416233585018   0.001351607219777   0.000155241707312  -0.000000000010318   0.000020628261875   0.000002598407863,...
   % 0.000001077491988   0.000263912042090   0.000015464817324   0.000120064131915   0.000026388448449   0.011797388945436   0.000134911570575   0.000219715764234,...
   % 0.000023286256097  -0.000000000010318   0.000004948749527   1.381265942727337   0.000101787678672   1.500800294064260   0.000000011518454   0.000108253721265,...
   % 0.000840448923402   0.000052596627627   0.000541754490809   0.000007410249832   0.000006762065110   0.000152146303757   0.050336407368373];
   
    
 %  Ptm1(ii,:)=      10000*[ 0.006411595531858   0.022508020045985   0.003621703706700   0.365160566719313   0.121720188906433   0.006475020014293   0.045736929944541   0.009854702537076,...
 %   0.286857663640666   0.068681224982333   0.558246735682857   0.000944489434415   0.000755591543763   0.000005460481896   0.000003780664311   0.000002275200790,...
 %   0.000006301107186   0.002161303814446   0.008776265021537   0.002797209269757  -0.000000000020971   0.000383124568798   0.000216507442531   0.001680897846804,...
 % 0.000369438278293   0.063716116044778   0.000416216009883   0.001351623004972   0.000155241707312  -0.000000000010318   0.000018819943941   0.000004038775750,...
 %   0.000001077485141   0.000263911873710   0.000015464817324   0.000120064131915   0.000026388448449   0.011797390114076   0.000134911739226   0.000219715989342,...
 %   0.000023286256097  -0.000000000010318   0.000004949537118   1.381265942727337   0.000101803878223   1.500800296912139   0.000000011518465   0.000108253721265,...
 %   0.000840448923402   0.000052596627627   0.000108350798645   0.000007410249776   0.000006762065058   0.000152146301606   0.050336407368373   ]; 
 % 
    
    

   Ptm1(ii,:)=      10000*[0.006411595531858   0.022508020045985   0.003621703706700   0.365160566719313   0.121720188906433   0.006475020014293   0.045736929944541   0.009854702537076,...
   0.286857663640666   0.068681224982333   0.558246735682857   0.000944489434415   0.000755591543763   0.000005460481896   0.000003780664311   0.000002275200790,...
   0.000006301107186   0.002161303814446   0.008776265021537   0.002797209269757  -0.000000000020971   0.000383124568798   0.000216507442531   0.001680897846804,...
   0.000369438278293   0.063716116044778   0.000416216009883   0.001351623004972   0.000155241707312  -0.000000000010318   0.000018819943941   0.000004038775750,...
   0.000001077485141   0.000263911873710   0.000015464817324   0.000120064131915   0.000026388448449   0.011797390114076   0.000134911739226   0.000219715989342,...
   0.000023286256097  -0.000000000010318   0.000004949537118   1.381265942727337   0.000101803878223   1.500800296912139   0.000000011518465   0.000108253721265,...
   0.000840448923402   0.000052596627627   0.000270876996612   0.000007410249797   0.000006762065078   0.000152146302413   0.050336407368373]; 

    
    end
end
clear ii B_grass B_tree Ptm1

load('9y_RF_Ptm1_Alp_BG3.mat')

%Zs = [ 0 10 20 50 100 150 200 300 400 500 600 800 1000 1200 1400 1600]; %%% [ms+1]
Zs = [ 0 10 20 50 100 150 200 300 400 500 600 700 800 900]; %%% [ms+1]
dz= diff(Zs); %%%% [mm]  Thickness of the Layers
for ii=1:ms_max
    O_t(:,ii,1)=  reshape(Ofc,m_cell*n_cell,1);
end
V_t(:,:,1)= (O_t(:,:,1) -reshape(Ohy,m_cell*n_cell,1)).*dz;
clear ii
clear Ofc Ohy








